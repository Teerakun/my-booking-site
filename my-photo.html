<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Photos | Drive Access</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #000; color: #fff; }
        .font-rog { font-family: 'Orbitron', sans-serif; }
        .rog-input { background: rgba(255,255,255,0.05) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; transition: 0.3s; }
        .rog-input:focus { border-color: #ff0032 !important; box-shadow: 0 0 15px rgba(255,0,50,0.3); outline: none; }
        .btn-rog { clip-path: polygon(5% 0, 100% 0, 100% 75%, 95% 100%, 0 100%, 0% 25%); }
        
        .fade-in { animation: fadeIn 0.8s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-6 bg-black">

    <div class="w-full max-w-md">
        <header class="mb-12 text-center">
            <h1 class="font-rog text-4xl font-bold text-[#ff0032] italic tracking-tighter">DATA LINK</h1>
            <p class="text-zinc-500 text-[10px] tracking-[0.5em] uppercase mt-2">Secure Cloud Access</p>
        </header>

        <div id="loginArea" class="bg-zinc-900/30 p-8 rounded-3xl border border-white/10 backdrop-blur-xl shadow-2xl">
            <div class="space-y-6">
                <div>
                    <label class="block text-[10px] text-zinc-500 uppercase font-rog mb-2">Student ID and Phonenumber</label>
                    <input type="text" id="login_sid" class="rog-input w-full p-4 rounded-xl text-sm" placeholder="รหัสนักเรียน">
                </div>
                <div>
                    <label class="block text-[10px] text-zinc-500 uppercase font-rog mb-2">Password</label>
                    <input type="password" id="login_pass" class="rog-input w-full p-4 rounded-xl text-sm" placeholder="รหัสผ่าน">
                </div>
                <button onclick="fetchDriveLink()" id="accessBtn" class="btn-rog w-full bg-[#ff0032] py-5 rounded-lg font-rog font-bold text-xs tracking-widest shadow-lg hover:brightness-125 transition-all">
                    CONNECT TO DRIVE
                </button>
                <p id="errorMsg" class="text-[#ff0032] text-[10px] text-center hidden font-bold uppercase tracking-tighter">
                    Access Denied: Incorrect ID or Password
                </p>
            </div>
        </div>

        <div id="resultArea" class="hidden fade-in text-center space-y-8">
            <div class="bg-zinc-900/50 p-10 rounded-3xl border border-[#ff0032]/30 shadow-[0_0_50px_rgba(255,0,50,0.1)]">
                <div class="mb-6 inline-block p-4 rounded-full bg-[#ff0032]/10">
                    <svg class="w-12 h-12 text-[#ff0032]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                    </svg>
                </div>
                <h2 class="font-rog text-xl text-white mb-2">AUTHENTICATED</h2>
                <p class="text-zinc-400 text-sm mb-8">พบโฟลเดอร์รูปภาพของคุณแล้ว กดปุ่มด้านล่างเพื่อเปิด Google Drive</p>
                
                <a id="driveLink" href="#" target="_blank" class="btn-rog block w-full bg-white text-black py-5 rounded-lg font-rog font-bold text-xs tracking-widest hover:bg-[#ff0032] hover:text-white transition-all">
                    OPEN CLOUD STORAGE
                </a>
            </div>
            
            <button onclick="location.reload()" class="text-zinc-600 text-[10px] font-rog tracking-widest hover:text-white">EXIT SESSION</button>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://majmptlrmxncbaxpthql.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ham1wdGxybXhuY2JheHB0aHFsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4MzU4NzEsImV4cCI6MjA4NTQxMTg3MX0.aV9y2QQp0wTCH21L-M1a0h_bheM3iqogcIO1BfL59FM';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function fetchDriveLink() {
            const sid = document.getElementById('login_sid').value;
            const pass = document.getElementById('login_pass').value;
            const btn = document.getElementById('accessBtn');
            const error = document.getElementById('errorMsg');

            btn.innerText = "VERIFYING...";
            btn.disabled = true;

            try {
                const { data, error: dbError } = await _supabase
                    .from('bookings')
                    .select('drive_url')
                    .eq('student_id', sid)
                    .eq('password', pass)
                    .single();

                if (dbError || !data || !data.drive_url) {
                    error.classList.remove('hidden');
                    btn.innerText = "CONNECT TO DRIVE";
                    btn.disabled = false;
                    return;
                }

                document.getElementById('loginArea').classList.add('hidden');
                document.getElementById('resultArea').classList.remove('hidden');
                document.getElementById('driveLink').href = data.drive_url;

            } catch (err) {
                alert("Connection Error");
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>